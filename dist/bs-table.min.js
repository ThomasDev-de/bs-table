(function($){"use strict";$.bsTable={version:"1.0.2",globalEventsBound:false,setDefaults(options){this.defaults=$.extend(true,{},this.defaults,options||{})},getDefaults(){return this.defaults},getColumnDefaults(){return this.columnDefaults},getCheckItemsConfigDefaults(){return this.checkItemsConfigDefaults},defaults:{height:undefined,ajaxOptions:undefined,classes:"table",toolbar:undefined,pagination:false,sidePagination:"client",paginationVAlign:"bottom",paginationHAlign:"end",pageNumber:1,pageSize:10,pageList:[5,10,25,50,100,200,"All"],search:false,sortName:null,sortOrder:"asc",showButtonRefresh:false,showHeader:true,showFooter:false,showButtonToggleColumns:false,showButtonColumnsChooser:false,showCheckItems:false,checkItemsConfig:{},cardView:false,detailView:false,showButtonCustomView:false,customView:false,onCustomView(_rows,_$td){},idField:undefined,url:null,data:null,columns:[],minimumCountColumns:1,icons:{sortAsc:"bi bi-chevron-down text-primary",sortDesc:"bi bi-chevron-up text-primary",sortNone:"bi bi-chevron-expand",refresh:"bi bi-arrow-clockwise",search:"bi bi-search",paginationNext:"bi bi-chevron-right",paginationPrev:"bi bi-chevron-left",toggleOff:"bi bi-toggle-off",toggleOn:"bi bi-toggle-on",customViewOff:"bi bi-columns-gap",customViewOn:"bi bi-table",checkAll:"bi bi-check-square-fill fw-bold",check:"bi bi-check-square fw-bold",uncheckAll:"bi bi-square fw-bold",uncheck:"bi bi-square fw-bold",expand:"bi bi-chevron-down",collapse:"bi bi-chevron-up"},caption:null,rowStyle(_row,_index,_$tr){},queryParams(_params){return _params},responseHandler(_res){return _res},onAll(_eventName,..._args){},onError(_message){},onExpandRow(_index,_row,_$tr){},onCollapseRow(_index,_row,_$tr){},onLoadSuccess(){},onLoadError(){},onPreBody(_rows,_$table){},onPostHeader(_$thead,_$table){},onPostBody(_rows,_$table){},onPostFooter(_$tfoot,_$table){},onRefresh(_params){},onSort(_name,_order){},onClickCell(_field,_value,_row,_$td){},onClickRow(_row,_$tr,_field){},onCheck(_row,_$input){},onCheckAll(){},onUncheck(_row,_$input){},onUncheckAll(){},formatNoMatches(){return`<i class="bi bi-x-lg fs-1 text-danger"></i>`},formatSearch(){return`...`},formatShowingRows(_pageFrom,_pageTo,_totalRows){return`Showing ${_pageFrom} to ${_pageTo} of ${_totalRows} rows`},formatRecordsPerPage(){return`records per page`},debug:false},columnDefaults:{class:undefined,field:undefined,sortable:false,visible:true,width:undefined,valign:"top",align:"left",halign:"start",falign:"start",formatter:undefined,footerFormatter:undefined,headerFormatter:undefined,events:undefined},checkItemsConfigDefaults:{type:"checkbox",name:"btSelectItem",field:"checkItems",clickRowToSelect:false,align:"center",valign:"top",position:"start",width:35,visible:true},detailViewDefaults:{align:"center",valign:"top",position:"start",width:35,visible:true,clickRowToToggle:false,field:"option",formatter:undefined},utils:{getUniqueId(prefix="bs_table_wrapper_"){const randomId=Math.random().toString(36).substring(2,10);return prefix+randomId},sortArrayByField(data,field,order="ASC"){const direction=order.toUpperCase()==="DESC"?-1:1;return data.sort((a,b)=>{if(a[field]==null&&b[field]==null){return 0}if(a[field]==null){return 1*direction}if(b[field]==null){return-1*direction}const aValue=typeof a[field]==="number"?a[field]:a[field].toString().toLowerCase();const bValue=typeof b[field]==="number"?b[field]:b[field].toString().toLowerCase();if(aValue>bValue){return 1*direction}if(aValue<bValue){return-1*direction}return 0})},calculateVisiblePagesOnNavigation(totalPages,currentPage){const visiblePages=[];if(currentPage<=4){for(let i=1;i<=Math.min(5,totalPages);i++){visiblePages.push(i)}if(totalPages>5){visiblePages.push("...");visiblePages.push(totalPages)}}else if(currentPage>=totalPages-3){visiblePages.push(1);if(totalPages>5){visiblePages.push("...")}for(let i=Math.max(totalPages-4,1);i<=totalPages;i++){visiblePages.push(i)}}else{visiblePages.push(1);visiblePages.push("...");visiblePages.push(currentPage-1);visiblePages.push(currentPage);visiblePages.push(currentPage+1);visiblePages.push("...");visiblePages.push(totalPages)}return visiblePages},executeFunction(functionOrName,...args){if(!functionOrName){return undefined}let func;if(typeof functionOrName==="function"){func=functionOrName}else if(typeof functionOrName==="string"){if(typeof window!=="undefined"&&typeof window[functionOrName]==="function"){func=window[functionOrName]}else{console.error(`Die Funktion "${functionOrName}" konnte nicht im globalen Kontext gefunden werden.`);return undefined}}if(!func){console.error(`Ungültige Funktion oder Name: "${functionOrName}"`);return undefined}return func(...args)},isValueEmpty(value){if(value===null||typeof value==="undefined"){return true}if(Array.isArray(value)){return value.length===0}if(typeof value==="string"){return value.trim().length===0}return false}}};const namespace=".bs.table";const bsTableClasses={wrapper:"bs-table",wrapperResponsive:"bs-table-responsive",overlay:"bs-table-overlay",topContainer:"bs-table-top-container",bottomContainer:"bs-table-bottom-container",search:"bs-table-search",searchInput:"bs-table-search-input",buttons:"bs-table-buttons",btnRefresh:"bs-table-btn-refresh",btnToggle:"bs-table-btn-toggle-view",btnCustomView:"bs-table-btn-custom-view",toolbar:"bs-table-toolbar",pagination:"bs-table-pagination",paginationDetails:"bs-table-pagination-details",wrapperSelection:"bs-table-selection",checkIcon:"bs-table-icon"};const methods={refreshOptions($table,settings){const setup=getSettings($table);const newSettings=$.extend(true,{},setup,settings||{});const customView=newSettings.customView===true;const cardView=!customView&&newSettings.cardView===true;setToggleCustomView($table,customView);setToggleView($table,cardView);setSettings($table,newSettings);makeSettingsValid($table);refresh($table)},hideRowByIndex($table,rowIndex){$($table).children("tbody").children(`tr[data-index="${rowIndex}"]:not(.d-none)`).addClass("d-none")},getHiddenColumns($table){const settings=getSettings($table);const hiddenColumns=[];settings.columns.forEach(column=>{if(column.visible===false){hiddenColumns.push(column.field)}});return hiddenColumns},getVisibleColumns($table){const settings=getSettings($table);const visibleColumns=[];settings.columns.forEach(column=>{if(column.visible===true){visibleColumns.push(column.field)}});return visibleColumns},showRowByIndex($table,rowIndex){$($table).children("tbody").children(`tr[data-index="${rowIndex}"].d-none`).removeClass("d-none")},getScrollPosition($table){const $wrapper=getResponsiveWrapper($table);return{x:$($wrapper).scrollLeft(),y:$($wrapper).scrollTop()}},showLoading($table){const wrapper=getWrapper($table);this.hideLoading($table);const $overlay=$("<div>",{class:bsTableClasses.overlay+" position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-body",css:{zIndex:4,opacity:0}}).appendTo(wrapper);$('<div class="spinner-border" style="width: 3rem; height: 3rem;" role="status">'+'<span class="visually-hidden">Loading...</span>'+"</div>").appendTo($overlay);$overlay.animate({opacity:.75},100)},hideLoading($table){const $overlay=$(getOverlay($table));if(!$overlay.length){return}$overlay.stop().animate({opacity:0},100,function(){$(this).remove()})}};$.fn.bsTable=function(optionsOrMethod,...args){if($(this).length===0){return $(this)}if($(this).length>1){return $(this).each(function(){return $(this).bsTable(optionsOrMethod,...args)})}const $table=$(this);initTable($table,optionsOrMethod);if(typeof optionsOrMethod==="string"){switch(optionsOrMethod){case"getVersion":{return $.bsTable.version}case"getData":{return getResponse($table).rows}case"getSelections":{return getSelected($table)}case"getOptions":{return getSettings($table)}case"getScrollPosition":{return methods.getScrollPosition($table)}case"showLoading":{methods.showLoading($table);break}case"hideLoading":{methods.hideLoading($table);break}case"refresh":{const arg=args.length?args[0]:null;refresh($table,arg);break}case"refreshOptions":{const arg=args.length?args[0]:null;if(arg&&typeof arg==="object"){methods.refreshOptions($table,arg)}else{console.warn("Invalid argument for refreshOptions: ",arg)}break}case"setCaption":{const arg=args.length?args[0]:null;setCaption($table,arg);break}case"hideRow":{const arg=args.length?args[0]:null;if(arg&&typeof arg==="object"&&arg.hasOwnProperty("index")){methods.hideRowByIndex($table,arg.index)}else{console.warn("Invalid argument for hideRow: ",arg)}break}case"showRow":{const arg=args.length?args[0]:null;if(arg&&typeof arg==="object"&&arg.hasOwnProperty("index")){methods.showRowByIndex($table,arg.index)}else{console.warn("Invalid argument for showRow: ",arg)}break}case"getHiddenColumns":{return methods.getHiddenColumns($table)}case"getVisibleColumns":{return methods.getVisibleColumns($table)}case"load":{const arg=args.length?args[0]:null;if(Array.isArray(arg)){const settings=getSettings($table);settings.data=arg;setSettings($table,settings);refresh($table,{pageNumber:1})}else{console.warn("Invalid argument for load: ",arg)}break}default:{console.warn(`Unknown method: ${optionsOrMethod}`);break}}}return $table};function initTable($table,optionsOrMethod){if($($table).data("bsTable")){if(typeof optionsOrMethod==="object"){methods.refreshOptions($table,optionsOrMethod)}return}if(!$.bsTable.globalEventsBound){registerGlobalTableEvents()}const options=typeof optionsOrMethod==="object"?optionsOrMethod:{};const settings=$.extend(true,{},$.bsTable.getDefaults(),$($table).data()||{},options||{});const bsTable={settings:settings,toggleView:settings.cardView===true,toggleCustomView:settings.customView===true,expanded:[],response:[],selected:[]};$($table).data("bsTable",bsTable);makeSettingsValid($table);build.structure($table);refresh($table)}function makeSettingsValid($table){const settings=getSettings($table);const columns=[];if(settings.columns&&Array.isArray(settings.columns)){settings.columns.forEach(column=>{if(typeof column==="object"){columns.push($.extend(true,{},$.bsTable.getColumnDefaults(),column||{}))}})}settings.columns=columns;if($.bsTable.utils.isValueEmpty(settings.columns)){settings.data=[]}const height=settings.height||$($table).data("height")||parseInt($($table).css("height"),10);if(!isNaN(height)&&height!==0){settings.height=height}else{settings.height=undefined}setSettings($table,settings);checkCheckItemsConfig($table);checkDetailViewConfig($table)}function checkDetailViewConfig($table){const settings=getSettings($table);if(settings.detailView===false){return}let isValid=true;let userConfig;if(typeof settings.detailView!=="object"){const error=`Invalid detailView configuration. Please provide an object.`;triggerEvent($table,"error",error);isValid=false}if(isValid){userConfig=$.extend(true,{},$.bsTable.detailViewDefaults,settings.detailView||{});if(!userConfig.hasOwnProperty("field")||!userConfig.field){userConfig.field=settings.idField}isValid=typeof userConfig.field==="string"&&settings.columns.some(column=>column.field===userConfig.field);if(!isValid){const error=`DetailView cannot be displayed. Missing or invalid property field: ${userConfig.field}`;triggerEvent($table,"error",error)}}if(isValid){userConfig.clickRowToToggle=typeof userConfig.clickRowToToggle==="boolean"?userConfig.clickRowToToggle:false;userConfig.visible=typeof userConfig.visible==="boolean"?userConfig.visible:true;userConfig.align=["start","left","center","end","right"].includes(userConfig.align)?userConfig.align:"center";userConfig.valign=["top","middle","bottom"].includes(userConfig.valign)?userConfig.valign:"middle";userConfig.position=["start","end"].includes(userConfig.position)?userConfig.position:"start"}settings.detailView=isValid?userConfig:false;setSettings($table,settings)}function checkCheckItemsConfig($table){const settings=getSettings($table);if(settings.showCheckItems!==true){settings.checkItemsConfig={};setSettings($table,settings);return}const defaultCheckItemsConfig=$.bsTable.getCheckItemsConfigDefaults();const userConfig=$.extend(true,{},defaultCheckItemsConfig,settings.checkItemsConfig||{});if(!userConfig.hasOwnProperty("field")||!userConfig.field){userConfig.field=settings.idField}let isValid=true;let isCheckbox=false;if(isValid){isValid=["checkbox","radio"].includes(userConfig.type);if(isValid){isCheckbox=userConfig.type==="checkbox"}else{isCheckbox=true;userConfig.type="checkbox"}}if(isValid){isValid=typeof userConfig.name==="string";if(isValid){const endsWithBraces=userConfig.name.endsWith("[]");if(isCheckbox&&!endsWithBraces){userConfig.name=userConfig.name+"[]"}if(!isCheckbox&&endsWithBraces){userConfig.name=userConfig.name.slice(0,-2)}}else{const error=[`Checkitems cannot be displayed.`,`Missing or invalid type for check item name: ${userConfig.name}.`,"Check item names must be a string."].join(" ");triggerEvent($table,"error",error)}}if(isValid){isValid=typeof userConfig.field==="string"&&settings.columns.some(column=>column.field===userConfig.field);if(!isValid){const error=[`Checkitems cannot be displayed.`,`Missing or invalid type for check item field: ${userConfig.field}.`,"The field must be found in one of the settings.collumns."].join(" ");triggerEvent($table,"error",error)}}if(isValid&&typeof userConfig.clickRowToSelect!=="boolean"){userConfig.clickRowToSelect=false}if(isValid&&typeof userConfig.visible!=="boolean"){userConfig.visible=false}if(isValid&&!["start","left","center","end","right"].includes(userConfig.align)){userConfig.align="center"}if(isValid&&!["top","middle","bottom"].includes(userConfig.valign)){userConfig.valign="middle"}if(isValid&&!["start","end"].includes(userConfig.position)){userConfig.position="start"}if(!isValid){settings.showCheckItems=false}settings.checkItemsConfig=userConfig;setSettings($table,settings)}function setCaption($table,stringOrObject){const settings=getSettings($table);let caption=$($table).find("caption:first");const isEmpty=$.bsTable.utils.isValueEmpty(stringOrObject);if(isEmpty){caption.remove();return}const captionClasses=[];const isString=typeof stringOrObject==="string";const isObject=typeof stringOrObject==="object";const captionText=isString?stringOrObject:isObject&&stringOrObject&&"text"in stringOrObject?stringOrObject.text:null;if(!caption.length){caption=$("<caption>",{html:captionText}).prependTo($table)}else{caption.html(captionText)}if(isObject){if(stringOrObject.hasOwnProperty("onTop")&&stringOrObject.onTop===true){captionClasses.push("caption-top");caption.addClass("caption-top")}}if(typeof settings.classes==="object"&&settings.classes.hasOwnProperty("caption")){caption.attr("class","");settings.classes.caption.split(" ").forEach(className=>{const classNameCheck=className.trim();if(!$.bsTable.utils.isValueEmpty(classNameCheck)){captionClasses.push(classNameCheck)}});caption.addClass(captionClasses.join(" "))}}function refresh($table,options=null,triggerRefresh=false){const settings=getSettings($table);let silent=false;let pageNumber=settings.pageNumber??1;let pageSize=settings.pageSize??10;let url=settings.url;let update=false;if(options&&typeof options==="object"){if(options.silent){silent=options.silent}if(options.pageNumber){pageNumber=Math.max(1,options.pageNumber);update=true}if(options.pageSize){pageSize=options.pageSize;update=true}if(options.url){url=options.url;update=true}}if(pageSize===0){pageNumber=1}if(update){settings.url=url;settings.pageNumber=pageNumber;settings.pageSize=pageSize;setSettings($table,settings)}if(!silent){methods.showLoading($table)}fetchData($table,triggerRefresh).then(()=>{const response=getResponse($table);triggerEvent($table,"load-success",response);build.table($table)}).catch(error=>{const errorMsg="Error when retrieving the data: "+error;triggerEvent($table,"load-error",errorMsg)}).finally(()=>{methods.hideLoading($table)})}function toggleView($table){setToggleView($table,!getToggleView($table));setToggleCustomView($table,false);build.table($table)}function toggleCustomView($table){setToggleCustomView($table,!getToggleCustomView($table));setToggleView($table,false);build.table($table)}function fetchData($jqTable,triggerRefresh=false){const $table=$($jqTable);const settings=getSettings($table);if(settings.debug){console.groupCollapsed("fetchData");console.log("Starte fetchData für Tabelle:",$table)}return new Promise((resolve,reject)=>{if(settings.debug){console.log("Einstellungen geladen:",settings)}if(!settings.url&&!(settings.data&&Array.isArray(settings.data))){if(settings.debug){console.error("Fehler: Weder eine API-URL noch lokale Daten konfiguriert.")}reject(new Error("Neither a URL nor local data were provided."));return}let params={};if(settings.sortName&&settings.sortOrder){params.sort=settings.sortName;params.order=settings.sortOrder}const pageNumber=settings.pageNumber>0?settings.pageNumber:1;const pageSize=settings.pageSize??10;if(pageSize===0){if(settings.debug){console.log("Besonderer Fall: pageSize = 0 (Alle Datensätze anzeigen).")}params.limit=null;params.offset=0}else{const offset=(pageNumber-1)*pageSize;params.limit=pageSize;params.offset=offset;if(settings.debug){console.log("Pagination-Parameter berechnet:",params)}}const searchInput=$(getSearchInput($table));if(settings.search&&searchInput.length){const searchValue=searchInput.val()?.trim()||null;params.search=searchValue&&!$.bsTable.utils.isValueEmpty(searchValue)?searchValue:null;if(settings.debug){console.log("Suchkriterien verarbeitet:",params.search)}}if(typeof settings.queryParams==="function"){params=settings.queryParams(params);if(settings.debug){console.log("Zusätzliche Query-Parameter:",params)}}if(triggerRefresh){triggerEvent($table,"refresh",params)}if(Array.isArray(settings.data)){if(settings.debug){console.log("Lokale Daten erkannt. Verarbeite lokale Daten...")}let filteredData=[...settings.data];if(params.sort&&params.order){if(settings.debug){console.log(`Sortiere lokale Daten nach "${params.sort}" in Reihenfolge "${params.order}".`)}$.bsTable.utils.sortArrayByField(filteredData,params.sort,params.order);if(settings.debug){console.log("Daten nach Sortierung:",filteredData)}}if(params.search){if(settings.debug){console.log("Suchfilter wird angewendet: ",params.search)}filteredData=filteredData.filter(row=>Object.values(row).some(value=>value&&value.toString().toLowerCase().includes(params.search.toLowerCase())));if(settings.debug){console.log(`Gefilterte Datenanzahl nach Suchkriterien (${params.search}):`,filteredData.length)}}const totalRows=filteredData.length;if(pageSize===0||settings.pagination===false){if(settings.debug){console.log("Alle Daten für pageSize = 0 oder pagination = false zurückgeben:",totalRows,"Datensätze.")}const responseBefore={rows:filteredData,total:totalRows};const responseAfter=$.bsTable.utils.executeFunction(settings.responseHandler,responseBefore);setResponse($table,responseAfter??responseBefore);if(settings.debug){console.groupEnd()}resolve();return}const offset=params.offset||0;const start=Math.min(totalRows,offset);const end=Math.min(totalRows,start+pageSize);const rowsToRender=end-start;if(settings.debug){console.log(`Pagination-Details: Offset=${offset}, Start=${start}, End=${end}, Rows to Render=${rowsToRender}`)}if(rowsToRender<=0){if(settings.debug){console.warn("Pagination-Ergebnis ist leer. Es gibt keine Daten für diese Seite.")}const responseBefore={rows:[],total:totalRows};const responseAfter=$.bsTable.utils.executeFunction(settings.responseHandler,responseBefore);setResponse($table,responseAfter??responseBefore);if(settings.debug){console.groupEnd()}resolve();return}const slicedData=filteredData.slice(start,end);if(settings.debug){console.log("Daten für aktuelle Seite (Slice-Ergebnis):",slicedData)}const responseBefore={rows:slicedData,total:totalRows};const responseAfter=$.bsTable.utils.executeFunction(settings.responseHandler,responseBefore);setResponse($table,responseAfter??responseBefore);if(settings.debug){console.groupEnd()}resolve();return}if(settings.url){if(settings.debug){console.log("Starte Datenabruf:",settings.url,"mit Parametern:",params)}if(typeof settings.url==="function"){settings.url(params).then(response=>{const processedResponse=Array.isArray(response)?{rows:response,total:response.length}:{...response,rows:response.rows||[],total:response.total||0};if(settings.debug){console.log("API-Antwort von Funktion erhalten:",processedResponse)}const responseAfter=$.bsTable.utils.executeFunction(settings.responseHandler,processedResponse);$table.data("response",responseAfter??processedResponse);resolve()}).catch(error=>{if(settings.debug){console.error("Fehler bei der Verarbeitung der Funktion:",error)}reject(new Error(`Fehler bei der API-Abfrage (Funktion): ${error.message||error}`))})}else if(typeof settings.url==="string"){const urlFunction=window[settings.url];if(typeof urlFunction==="function"){urlFunction(params).then(response=>{const processedResponse=Array.isArray(response)?{rows:response,total:response.length}:{...response,rows:response.rows||[],total:response.total||0};if(settings.debug){console.log("API-Antwort von Funktion erhalten:",processedResponse)}const responseAfter=$.bsTable.utils.executeFunction(settings.responseHandler,processedResponse);$($table).data("response",responseAfter??processedResponse);resolve()}).catch(error=>{if(settings.debug){console.error("Error in functional URL processing:",error)}reject(new Error(`Error processing of the function: ${error.message||error}`))})}else{let defaultAjaxOptions={url:settings.url,method:"GET",data:params,dataType:"json"};const customAjaxOptions=$.bsTable.utils.executeFunction(settings.ajaxOptions,settings.url,params);if(customAjaxOptions&&typeof customAjaxOptions==="object"){defaultAjaxOptions=$.extend(true,{},defaultAjaxOptions,customAjaxOptions||{})}const xhr=$($table).data("xhr")||null;if(xhr!==null){xhr.abort();$($table).removeData("xhr")}$table.data("xhr",$.ajax(defaultAjaxOptions).done(response=>{const processedResponse=Array.isArray(response)?{rows:response,total:response.length}:{...response,rows:response.rows||[],total:response.total||0};if(settings.debug){console.log("API-Antwort von String-URL erhalten:",processedResponse)}const responseAfter=$.bsTable.utils.executeFunction(settings.responseHandler,processedResponse);$table.data("response",responseAfter??processedResponse);resolve()}).fail((xhr,status,error)=>{if(settings.debug){console.error("Fehler bei der API-Abfrage (String-URL):",status,error)}reject(new Error(`Fehler bei der API-Abfrage (String-URL): ${status}, ${error}`))}).finally(()=>{$table.removeData("xhr")}))}}}})}const build={structure($tableElement){const $table=$($tableElement);$table.empty();const settings=getSettings($table);const wrapperId=$.bsTable.utils.getUniqueId();const $wrapper=$("<div>",{class:bsTableClasses.wrapper+" position-relative",id:wrapperId}).insertAfter($table);const isChild=$(getClosestWrapper($wrapper)).length>0?"true":"false";$wrapper.attr("data-child",isChild);const $wrapperResponsive=$("<div>",{class:"table-responsive "+bsTableClasses.wrapperResponsive}).appendTo($wrapper);$table.attr("data-wrapper",wrapperId);$table.appendTo($wrapperResponsive);setCaption($table,settings.caption);this.tableTopContainer($table);this.tableBottomContainer($table);$("<thead></thead>").appendTo($table);$("<tbody></tbody>").appendTo($table);$("<tfoot></tfoot>").appendTo($table)},dropdownPageList($tableElement){const $table=$($tableElement);const settings=getSettings($table);const response=getResponse($table);const totalRows=response.total||(response.rows?response.rows.length:0);const pageSize=settings.pageSize||totalRows;const smallBtn=$table.hasClass("table-sm")?"btn-sm":"";const $dropdownWrapper=$("<div>",{class:"dropdown btn-group","data-role":"tablePaginationPageSize"});const $dropdownToggle=$("<button>",{class:`btn ${smallBtn} btn-secondary dropdown-toggle`,type:"button",id:"dropdownPaginationPageSize","data-bs-toggle":"dropdown","aria-expanded":"false"}).html(pageSize===totalRows?"All":pageSize);const $dropdownMenu=$("<ul>",{css:{zIndex:1021},class:"dropdown-menu dropdown-menu-end  bg-gradient ","aria-labelledby":"dropdownPaginationPageSize"});settings.pageList.filter(page=>page==="All"||page<totalRows).forEach(page=>{const value=page==="All"?0:page;const isAll=value===0;const isActive=isAll&&pageSize===0||page===pageSize;const text=isAll?"All":page;const $dropdownItem=$("<li>").append($("<a>",{class:`dropdown-item ${isActive?"active":""}`,href:"#","data-page":value}).text(text));$dropdownMenu.append($dropdownItem)});$dropdownWrapper.append($dropdownToggle,$dropdownMenu);return $dropdownWrapper},dropdownColumns($table,smallBtnClass){const settings=getSettings($table);if(!settings.columns||!settings.columns.length){return null}const $dropdownWrapper=$("<div>",{class:"dropdown btn-group","data-role":"tableColumnVisibility"});const $dropdownToggle=$("<button>",{class:`btn btn-secondary dropdown-toggle ${smallBtnClass} $(disabledClass)`,type:"button",id:"dropdownColumnVisibility","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"}).html('<i class="bi bi-layout-three-columns"></i>');const $dropdownMenu=$("<div>",{css:{zIndex:1021},class:"dropdown-menu bg-gradient dropdown-menu-end","aria-labelledby":"dropdownColumnVisibility"});let colIndex=0;let checkedColumnsCount=settings.columns.filter(column=>column.visible!==false).length;function updateCheckboxStates(){const checked=$dropdownMenu.find('input[type="checkbox"]:checked');const notChecked=$dropdownMenu.find('input[type="checkbox"]:not(:checked)');if(checked.length<=settings.minimumCountColumns){checked.prop("disabled",true)}else{checked.prop("disabled",false)}notChecked.prop("disabled",false)}settings.columns.forEach(column=>{const isVisible=column.visible!==false;const uniqueId=$.bsTable.utils.getUniqueId("bs_table_column_visibility_");const $menuItem=$("<div>",{class:"dropdown-item px-3"}).append($("<div>",{class:"form-check d-flex align-items-center"}).append($("<input>",{class:"form-check-input me-2",type:"checkbox",id:`${uniqueId}`,"data-column-index":colIndex,checked:isVisible}).on("change"+namespace,function(e){const $checkbox=$(e.currentTarget);const columnIndex=$checkbox.data("column-index");const isChecked=$checkbox.is(":checked");settings.columns[columnIndex].visible=isChecked;setSettings($table,settings);toggleColumnVisibility($table,columnIndex,isChecked);checkedColumnsCount+=isChecked?1:-1;updateCheckboxStates()}),$("<label>",{class:"form-check-label mb-0",for:`${uniqueId}`}).text(column.title||column.field||`Column ${colIndex+1}`).on("click"+namespace,function(e){e.preventDefault();const label=$(e.currentTarget);const $checkbox=$(`#${label.attr("for")}`);$checkbox.prop("checked",!$checkbox.is(":checked")).trigger("change"+namespace)})));$dropdownMenu.append($menuItem);colIndex++});updateCheckboxStates();$dropdownWrapper.append($dropdownToggle,$dropdownMenu);return $dropdownWrapper},buttons($tableElement){const $table=$($tableElement);const $wrapper=$(getWrapper($table));const settings=getSettings($table);const $btnContainer=$wrapper.find(`.${bsTableClasses.buttons}:first`).empty();const smallBtnClass=$table.hasClass("table-sm")?"btn-sm":"";if(settings.showButtonRefresh===true){$(`<button>`,{class:`btn btn-secondary ${bsTableClasses.btnRefresh} ${smallBtnClass}`,html:`<i class="${settings.icons.refresh}"></i>`}).appendTo($btnContainer)}if(settings.showButtonToggleColumns===true){const toggleIcon=getToggleView($table)?settings.icons.toggleOn:settings.icons.toggleOff;$(`<button>`,{class:`btn btn-secondary ${bsTableClasses.btnToggle} ${smallBtnClass}`,html:`<i class="${toggleIcon}"></i>`}).prependTo($btnContainer)}if(settings.showButtonCustomView===true){const toggleIcon=getToggleCustomView($table)?settings.icons.customViewOn:settings.icons.customViewOff;$(`<button>`,{class:`btn btn-secondary ${bsTableClasses.btnCustomView} ${smallBtnClass}`,html:`<i class="${toggleIcon}"></i>`}).prependTo($btnContainer)}if(settings.showButtonColumnsChooser===true){const dropDown=this.dropdownColumns($table,smallBtnClass);if(dropDown){$(dropDown).prependTo($btnContainer)}}},tableTopContainer($table){const $wrapper=getWrapper($table);const settings=getSettings($table);let flexClass="flex-row";if(!["right","end"].includes(settings.paginationHAlign)){flexClass+=" flex-row-reverse"}let gapClass="";if(settings.pagination===true&&["top","both"].includes(settings.paginationVAlign)||settings.search===true||settings.toolbar||settings.showButtonRefresh){gapClass="gap-2 py-2"}const template=""+'<div class="d-flex flex-column '+gapClass+" "+bsTableClasses.topContainer+'">'+'<div class="d-flex justify-content-end align-items-end">'+'<div class="d-flex '+bsTableClasses.toolbar+' me-auto"></div>'+'<div class="d-flex '+bsTableClasses.search+'"></div>'+'<div class="btn-group '+bsTableClasses.buttons+'"></div>'+"</div>"+'<div class="d-flex justify-content-between align-items-end '+flexClass+'">'+'<div class="'+bsTableClasses.paginationDetails+'"></div>'+'<div class="'+bsTableClasses.pagination+' top"></div>'+"</div>"+"</div>";const $tableTopContainer=$(template).prependTo($wrapper);const $toolbarContainer=$tableTopContainer.find("."+bsTableClasses.toolbar);const $searchWrapper=$tableTopContainer.find("."+bsTableClasses.search);if(settings.toolbar&&$(settings.toolbar).length>0){$(settings.toolbar).prependTo($toolbarContainer)}if(settings.search===true){const placeholder=$.bsTable.utils.executeFunction(settings.formatSearch);const $searchInputGroup=$(`<div class="input-group">`+'<span class="input-group-text">'+'<i class="'+settings.icons.search+'"></i>'+"</span>"+'<input type="search" class="form-control '+bsTableClasses.searchInput+'" placeholder="'+placeholder+'">'+"</div>");$searchInputGroup.appendTo($searchWrapper)}this.buttons($table)},tableBottomContainer($table){const $wrapper=getWrapper($table);const settings=getSettings($table);let flexClass="flex-row";if(!["right","end"].includes(settings.paginationHAlign)){flexClass+=" flex-row-reverse"}let gapClass="";if(settings.pagination===true&&["bottom","both"].includes(settings.paginationVAlign)){gapClass="gap-2 py-2"}const template=['<div class="d-flex flex-column '+gapClass+" "+bsTableClasses.bottomContainer+'">','<div class="d-flex justify-content-between align-items-start '+flexClass+'">','<div class="'+bsTableClasses.paginationDetails+'"></div>','<div class="'+bsTableClasses.pagination+' bottom"></div>',"</div>",'<div class="'+bsTableClasses.wrapperSelection+'"></div>',"</div>"].join("");$(template).appendTo($wrapper)},hiddenSelectedInputs($table){const selections=getSelected($table);const settings=getSettings($table);const $bottomContainer=$(getTableBottomContainer($table)).find(`.${bsTableClasses.wrapperSelection}`).empty();if(settings.showCheckItems===true){const checkItem=settings.checkItemsConfig;selections.forEach(row=>{const value=row[checkItem.field];$("<input>",{type:"hidden",name:`${checkItem.name}`,value:value}).appendTo($bottomContainer)});this.updateCheckItemsActive($table)}},updateCheckItemsActive($tableElement){const $table=$($tableElement);const settings=getSettings($table);if(settings.showCheckItems!==true){return}const checkItemsConfig=settings.checkItemsConfig;const $tbody=$($table.children("tbody"));const $thead=$($table.children("thead"));const $tfoot=$($table.children("tfoot"));const selectedRows=getSelected($table);const responseRows=getResponse($table).rows;let activeClassName=null;if(typeof settings.classes==="object"&&settings.classes.hasOwnProperty("active")){activeClassName=settings.classes.active}let index=0;responseRows.forEach(row=>{const selected=selectedRows.some(selected=>selected[checkItemsConfig.field]===row[checkItemsConfig.field]);const $tr=$($tbody.children("tr[data-index]")).eq(index);const $td=$tr.find("td[data-check-item]").first();$td.attr("data-check-item",selected?"true":"false");const iconClass=selected?settings.icons.check:settings.icons.uncheck;const $icon=$td.find("."+bsTableClasses.checkIcon);[settings.icons.check,settings.icons.uncheck].forEach(iconSet=>iconSet.split(/\s+/).forEach(cls=>$icon.removeClass(cls)));$icon.addClass(iconClass);if(activeClassName){if(selected){$tr.addClass(activeClassName)}else{$tr.removeClass(activeClassName)}}index++});const selectedValues=selectedRows.map(row=>row[checkItemsConfig.field]);let markHeaderChecked=false;if(checkItemsConfig.type==="checkbox"){markHeaderChecked=responseRows.every(row=>selectedValues.indexOf(row[checkItemsConfig.field])!==-1)}else if(checkItemsConfig.type==="radio"){markHeaderChecked=responseRows.some(row=>selectedValues.indexOf(row[checkItemsConfig.field])!==-1)}const $headerTh=$thead.find("th[data-check-item-all]").first();const $footerTh=$tfoot.find("th[data-check-item-all]").first();$headerTh.attr("data-check-item-all",markHeaderChecked?"true":"false");$footerTh.attr("data-check-item-all",markHeaderChecked?"true":"false");const $headerIcon=$headerTh.find("."+bsTableClasses.checkIcon);const $footerIcon=$footerTh.find("."+bsTableClasses.checkIcon);[settings.icons.checkAll,settings.icons.uncheckAll].forEach(iconSet=>iconSet.split(/\s+/).forEach(cls=>{$headerIcon.removeClass(cls);$footerIcon.removeClass(cls)}));$headerIcon.addClass(markHeaderChecked?settings.icons.checkAll:settings.icons.uncheckAll);$footerIcon.addClass(markHeaderChecked?settings.icons.checkAll:settings.icons.uncheckAll)},pagination($tableElement,totalRows){const $table=$($tableElement);const settings=getSettings($table);const totalPages=Math.ceil(totalRows/settings.pageSize);const currentPage=settings.pageNumber||1;const $paginationWrapper=$("<nav>",{"data-role":"tablePagination"});const small=$table.hasClass("table-sm");const $paginationList=$("<ul>",{class:"pagination justify-content-center m-0"}).appendTo($paginationWrapper);if(small){$paginationList.addClass("pagination-sm")}const createPageItem=(role,disabled,active,content)=>{const $item=$("<li>",{"data-role":role,class:`page-item ${disabled?"disabled":""} ${active?"active":""}`}).appendTo($paginationList);$("<a>",{class:"page-link",href:"#",tabindex:disabled?"-1":"","aria-disabled":disabled?"true":"false",html:content}).appendTo($item)};createPageItem("previous",currentPage===1,false,`<i class="${settings.icons.paginationPrev}"></i>`);const visiblePages=$.bsTable.utils.calculateVisiblePagesOnNavigation(totalPages,currentPage);visiblePages.forEach(page=>{if(page==="..."){createPageItem(null,true,false,"...")}else{createPageItem(null,false,page===currentPage,page)}});createPageItem("next",currentPage===totalPages,false,`<i class="${settings.icons.paginationNext}"></i>`);return $paginationWrapper},paginationDetails($table,totalRows){const settings=getSettings($table);const wrapper=$(getClosestWrapper($table));const pageSize=settings.pagination===false?totalRows:settings.pageSize||totalRows;const currentPage=settings.pagination===false?1:settings.pageNumber||1;const startRow=totalRows===0?0:(currentPage-1)*pageSize+1;const endRow=Math.min(totalRows,currentPage*pageSize);const text=$.bsTable.utils.executeFunction(settings.formatShowingRows,startRow,endRow,totalRows);const dropdown=$(build.dropdownPageList($table));const $paginationText=$("<div>",{class:"d-flex align-items-center",html:`<div class="me-3">${text}</div>`});dropdown.appendTo($paginationText);const records=$.bsTable.utils.executeFunction(settings.formatRecordsPerPage,pageSize);$("<div>",{class:"ms-2",html:records}).appendTo($paginationText);const $allDestinations=wrapper.find("."+bsTableClasses.paginationDetails);if($allDestinations.length>0){const showOnTop=["top","both"].includes(settings.paginationVAlign);const showOnBottom=["bottom","both"].includes(settings.paginationVAlign);const $first=$allDestinations.first().empty();const $last=$allDestinations.last().empty();if(showOnTop){$paginationText.clone().appendTo($first)}if(showOnBottom){$paginationText.clone().appendTo($last)}}},table($tableElement){const $table=$($tableElement);const settings=getSettings($table);if(settings.debug){console.groupCollapsed("Render Table")}if(typeof settings.height!=="undefined"){$(getResponsiveWrapper($table)).css("max-height",settings.height)}const wrapper=$(getClosestWrapper($table));const response=getResponse($table);if(settings.debug){console.log("Response:",response)}const totalRows=response.total||(response.rows?response.rows.length:0);const pageSize=settings.pageSize;const pageNumber=settings.pageNumber;let currentPageData=response.rows;if(settings.debug){console.log("Total Rows:",totalRows);console.log("Page Size:",pageSize);console.log("Page Number:",pageNumber);console.log("Rows to Render:",currentPageData.length,currentPageData);console.groupEnd()}this.thead($table,currentPageData);this.tbody($table,currentPageData);this.tfoot($table,currentPageData);this.hiddenSelectedInputs($table);const tableClasses=[];if(typeof settings.classes==="string"){settings.classes.split(" ").forEach(className=>{const name=className.trim();if(!$.bsTable.utils.isValueEmpty(name)){tableClasses.push(className)}})}else if(typeof settings.classes==="object"&&settings.classes.hasOwnProperty("table")){settings.classes.table.split(" ").forEach(className=>{const name=className.trim();if(!$.bsTable.utils.isValueEmpty(name)){tableClasses.push(className)}})}if(!tableClasses.includes("table")){tableClasses.push("table")}if(!tableClasses.includes("mb-0")){tableClasses.push("mb-0")}$table.removeClass();$table.addClass(tableClasses.join(" "));const searchWrapper=wrapper.find("."+bsTableClasses.search+":first").find(".input-group");if(searchWrapper.length){if($table.hasClass("table-sm")){searchWrapper.addClass("input-group-sm")}else{searchWrapper.removeClass("input-group-sm")}}build.buttons($table);const $topPaginationContainer=$(getPaginationContainer($table,true)).empty();const $bottomPaginationContainer=$(getPaginationContainer($table,false)).empty();const $tableTopContainer=$(getTableTopContainer($table));const $btnContainer=$tableTopContainer.find(`.${bsTableClasses.buttons}:first`);if($btnContainer.find(".btn").length&&settings.search===true){$btnContainer.addClass("ms-2")}else{$btnContainer.removeClass("ms-2")}if(settings.pagination){this.paginationDetails($table,totalRows);if(pageSize!==0){const $paginationHtml=$(this.pagination($table,totalRows));const showOnTop=["top","both"].includes(settings.paginationVAlign);const showOnBottom=["bottom","both"].includes(settings.paginationVAlign);if(showOnTop){$topPaginationContainer.append($paginationHtml.clone())}if(showOnBottom){$bottomPaginationContainer.append($paginationHtml.clone())}}}},thead($tableElement,data){const $table=$($tableElement);const settings=getSettings($table);const columns=settings.columns||[];const showHeader=columns.length&&settings.showHeader===true&&!getToggleView($table)&&!getToggleCustomView($table);const headerClasses=[];if(!showHeader){headerClasses.push("d-none")}if(typeof settings.classes==="object"&&settings.classes.hasOwnProperty("thead")){settings.classes.thead.split(" ").forEach(className=>{const name=className.trim();if(!$.bsTable.utils.isValueEmpty(name)){headerClasses.push(className)}})}if(typeof settings.height!=="undefined"){headerClasses.push("sticky-top")}const $thead=$($table.children("thead")).empty().addClass(headerClasses.join(" "));if(showHeader){$thead.removeClass("d-none")}const $tr=$("<tr></tr>").appendTo($thead);if(showHeader){let colIndex=0;columns.forEach(column=>{this.theadTr(column,$tr,colIndex,data);colIndex++});if(settings.detailView!==false){buildDetailView($table,$tr,true)}if(settings.showCheckItems===true){buildCheckItem($table,$tr,false,true)}triggerEvent($table,"post-header",$thead,$table)}},theadTr(column,$tr,colIndex,data){const $table=$($tr).closest("table");const settings=getSettings($table);const isSortable=column.sortable===true;const order=column.field===settings.sortName?settings.sortOrder??"":"";const $th=$("<th>",{"data-sortable":isSortable?"true":"false","data-field":column.field,"data-order":order,"data-col-index":colIndex}).appendTo($tr);const formatterValue=$.bsTable.utils.executeFunction(column.headerFormatter,data,$th);const value=!$.bsTable.utils.isValueEmpty(formatterValue)?formatterValue:column.title||"Column "+(colIndex+1);$th.empty();if(isSortable){const $container=$("<div>",{class:"d-flex align-items-center justify-content-between"});const $title=$("<div>",{class:"flex-fill me-1",html:value});const $icon=$("<div>").append($("<i>",{class:`bs-table-icon ${getIconBySortOrder($table,order)}`}));$container.append($title).append($icon);$th.append($container);$th.css("cursor","pointer")}else{$th.html(value)}if(column.width){$th.css("width",column.width)}const alignmentClasses={end:"text-end",right:"text-end",start:"text-start",left:"text-start",center:"text-center",middle:"text-center"};const classList=[column.halign&&alignmentClasses[column.halign]?alignmentClasses[column.halign]:"",column.visible===false?"d-none":""].filter(Boolean);if(classList.length){$th.addClass(classList.join(" "))}},tbody($tableElement,rows){const $table=$($tableElement);const settings=getSettings($table);const selected=getSelected($table);const expandedElements=getExpanded($table);triggerEvent($table,"pre-body",rows,$table);const hasColumns=settings.columns&&settings.columns.length;const $tbody=$($table.children("tbody")).empty();const inToggleView=getToggleView($table);const inToggleCustomView=getToggleCustomView($table);const hasResponse=rows&&rows.length>0;const expandRows=[];let bodyClasses=[];if(typeof settings.classes==="object"&&settings.classes.hasOwnProperty("tbody")){settings.classes.tbody.split(" ").forEach(className=>{const classNameTrimmed=className.trim();if(!$.bsTable.utils.isValueEmpty(classNameTrimmed)){bodyClasses.push(classNameTrimmed)}})}$tbody.addClass(bodyClasses.join(" "));if(!hasResponse){const $tr=$("<tr></tr>").appendTo($tbody);$("<td>",{colspan:getCountColumns($table),class:"text-center",html:settings.formatNoMatches()}).appendTo($tr)}else if(inToggleCustomView){const $tr=$("<tr></tr>").appendTo($tbody);const $td=$("<td>",{colspan:getCountColumns($table)}).appendTo($tr);triggerEvent($table,"custom-view",rows,$td)}else{let trIndex=0;rows.forEach(row=>{const $tr=$("<tr>",{"data-index":trIndex}).appendTo($tbody);if(getToggleView($table)){$tr.addClass("d-flex flex-column")}$tr.data("row",row);$.bsTable.utils.executeFunction(settings.rowStyle,row,trIndex,$tr);if(hasColumns){let colIndex=0;settings.columns.forEach(column=>{this.tbodyTd(column,row,$tr,colIndex,inToggleView);colIndex++});if(settings.detailView!==false){const expanded=expandedElements.includes(row[settings.detailView.field]);if(expanded){expandRows.push($tr)}buildDetailView($table,$tr,false)}if(settings.showCheckItems===true){const checked=selected.some(item=>item[settings.checkItemsConfig.field]===row[settings.checkItemsConfig.field]);buildCheckItem($table,$tr,checked,false)}}trIndex++});expandRows.forEach(row=>{const tdToExpand=row.find("[data-detail-item]");toggleExpandOrCollapse(tdToExpand,false)})}const tableResponsive=$(getResponsiveWrapper($table));if(tableResponsive.length){tableResponsive.scrollTop(0)}triggerEvent($table,"post-body",rows,$table)},tbodyTd(column,row,$tr,colIndex,inToggleView){if(column.field){const trIndex=$($tr).data("index");let classList=[];if(column.class){column.class.split(" ").forEach(className=>{classList.push(className)})}if(column.align){let align=null;if(["end","right"].includes(column.align)){align="end"}if(["start","left"].includes(column.align)){align="start"}if(["center","middle"].includes(column.align)){align="center"}if(null!==align){classList.push("text-"+align)}}if(column.valign){classList.push("align-"+column.valign)}const $td=$("<td>",{"data-col-index":colIndex,class:classList.join(" ")}).appendTo($tr);if(inToggleView){$td.css("width","100%")}else if(column.width){$td.css("width",column.width)}if(column.visible===false){$td.addClass("d-none")}$td.data("column",column);$td.data("trIndex",trIndex);let value=row[column.field]??" - ";const valueFormatter=$.bsTable.utils.executeFunction(column.formatter,value,row,trIndex,$td);if(!$.bsTable.utils.isValueEmpty(valueFormatter)){value=valueFormatter}if($td.html().trim()===""){$td.html(value)}if(column.events){for(let[eventSelector,eventHandler]of Object.entries(column.events)){(function(eventSelector,eventHandler,columnFieldValue,rowData){const splitEvent=eventSelector.split(" ");const selector=splitEvent.pop();const eventTypes=splitEvent.join(" ");if(selector){$td.on(eventTypes,selector,function(e){eventHandler(e,columnFieldValue,rowData,trIndex)})}else{$td.on(eventTypes,function(e){eventHandler(e,columnFieldValue,rowData,trIndex)})}})(eventSelector,eventHandler,row[column.field]??null,row)}}}},tfoot($tableElement,data){const $table=$($tableElement);const settings=getSettings($table);const columns=settings.columns||[];const showFooter=columns.length&&settings.showFooter===true&&!getToggleView($table)&&!getToggleCustomView($table);const footerClasses=[];if(!showFooter){footerClasses.push("d-none")}if(typeof settings.classes==="object"&&settings.classes.hasOwnProperty("tfoot")){settings.classes.tfoot.split(" ").forEach(className=>{const classNameTrimmed=className.trim();if(!$.bsTable.utils.isValueEmpty(classNameTrimmed)){footerClasses.push(classNameTrimmed)}})}if(typeof settings.height!=="undefined"){footerClasses.push("sticky-bottom")}const $tfoot=$($table.children("tfoot")).empty().addClass(footerClasses.join(" "));if(showFooter){$tfoot.removeClass("d-none")}const $tr=$("<tr></tr>").appendTo($tfoot);if(showFooter){let colIndex=0;columns.forEach(column=>{this.tfootTr(column,$tr,colIndex,data);colIndex++});if(settings.detailView!==false){buildDetailView($table,$tr,true)}if(settings.showCheckItems===true){buildCheckItem($table,$tr,false,true)}triggerEvent($table,"post-footer",$tfoot,$table)}},tfootTr(column,$tr,colIndex,data){const $th=$("<th>",{"data-col-index":colIndex}).appendTo($tr);const formatterValue=$.bsTable.utils.executeFunction(column.footerFormatter,data,$th);const value=!$.bsTable.utils.isValueEmpty(formatterValue)?formatterValue:"";$th.html(value);const alignmentClasses={end:"text-end",right:"text-end",start:"text-start",left:"text-start",center:"text-center",middle:"text-center"};const classList=[column.falign&&alignmentClasses[column.falign]?alignmentClasses[column.falign]:"",column.visible===false?"d-none":""].filter(Boolean);if(classList.length){$th.addClass(classList.join(" "))}}};function toggleColumnVisibility($tableElement,colIndex,isVisible){const $table=$($tableElement);const $theadThs=$($table.children("thead")).children("tr").children(`th[data-col-index="${colIndex}"]`);const $tbodyTds=$($table.children("tbody")).children("tr").children(`td[data-col-index="${colIndex}"]`);const $tfootCells=$($table.children("tfoot")).children("tr").children(`[data-col-index="${colIndex}"]`);if(isVisible){$theadThs.removeClass("d-none");$tbodyTds.removeClass("d-none");$tfootCells.removeClass("d-none")}else{$theadThs.addClass("d-none");$tbodyTds.addClass("d-none");$tfootCells.addClass("d-none")}}function getIconBySortOrder($table,sortOrder){const{icons}=getSettings($table);const iconMap={asc:icons.sortAsc,desc:icons.sortDesc,default:icons.sortNone};return iconMap[sortOrder]||iconMap.default}function buildCheckItem($table,$tr,checked=false,forHeader=false){const settings=getSettings($table);if(settings.showCheckItems!==true){return}const checkItem=settings.checkItemsConfig;let icon;if(!forHeader){icon=checked?settings.icons.check:settings.icons.uncheck}else{icon=checked?settings.icons.checkAll:settings.icons.uncheckAll}const classes=[];if(["start","left"].includes(checkItem.align)){classes.push("text-start")}else if(["end","right"].includes(checkItem.align)){classes.push("text-end")}else{classes.push("text-center")}if(checkItem.valign==="top"){classes.push("align-top")}else if(checkItem.valign==="middle"){classes.push("align-middle")}else{classes.push("align-bottom")}const $cell=$(forHeader?"<th></th>":"<td></td>",{class:classes.join(" "),css:{cursor:"pointer"},html:`<i class="${bsTableClasses.checkIcon} ${icon}"></i>`});if(checkItem.width&&checkItem.visible===true){$cell.css("width",checkItem.width)}if(checkItem.visible!==true){$cell.addClass("d-none")}if(forHeader){$cell.attr("data-check-item-all","false")}else{$cell.attr("data-check-item",checked?"true":"false")}if(checkItem.position==="start"){$cell.prependTo($tr)}else{$cell.appendTo($tr)}}function buildDetailView($table,$tr,forHeader=false){const settings=getSettings($table);if(settings.detailView===false){return}const checkItem=settings.detailView;let icon;if(!forHeader){icon=settings.icons.expand}else{icon="bi bi-plus-slash-minus"}const classes=[];if(["start","left"].includes(checkItem.align)){classes.push("text-start")}else if(["end","right"].includes(checkItem.align)){classes.push("text-end")}else{classes.push("text-center")}if(checkItem.valign==="top"){classes.push("align-top")}else if(checkItem.valign==="middle"){classes.push("align-middle")}else{classes.push("align-bottom")}const $cell=$(forHeader?"<th></th>":"<td></td>",{class:classes.join(" "),css:{cursor:"pointer"},html:`<i class="${bsTableClasses.checkIcon} ${icon}"></i>`});if(checkItem.width&&checkItem.visible===true){$cell.css("width",checkItem.width)}if(checkItem.visible!==true){$cell.addClass("d-none")}if(forHeader){$cell.attr("data-detail-item-all","false")}else{$cell.attr("data-detail-item","false")}if(checkItem.position==="start"){$cell.prependTo($tr)}else{$cell.appendTo($tr)}}function getCountColumns($table,onlyVisible=true){const settings=getSettings($table);if(!settings.columns||!settings.columns.length){return 0}let columnCount=settings.columns.filter(column=>!onlyVisible||column.visible!==false).length;if(settings.showCheckItems!==false){columnCount+=1}if(settings.detailView!==false){columnCount+=1}return columnCount}function getSettings($table){return $($table).data("bsTable").settings}function setSettings($table,settings){const data=$($table).data("bsTable");if(data){data.settings=settings}$($table).data("bsTable",data)}function getResponse($table){return $($table).data("bsTable").response||{rows:[],total:0}}function getSelected($table){return $($table).data("bsTable").selected||[]}function getExpanded($table){return $($table).data("bsTable").expanded||[]}function removeExpanded($tableElement,row){const $table=$($tableElement);const data=$table.data("bsTable");const setup=$.bsTable.detailViewDefaults;const field=row[setup.field];if(data.expanded.includes(field)){data.expanded=data.expanded.filter(item=>item!==field);$table.data("bsTable",data)}}function addExpanded($tableElement,row){const $table=$($tableElement);const data=$table.data("bsTable");const setup=$.bsTable.detailViewDefaults;const field=row[setup.field];if(!data.expanded.includes(field)){data.expanded.push(field);$table.data("bsTable",data)}}function addSelected($tableElement,selected){const $table=$($tableElement);const data=$table.data("bsTable");const checkItemsConfig=data.settings.checkItemsConfig;if(data){const exists=data.selected.some(item=>item[checkItemsConfig.field]===selected[checkItemsConfig.field]);if(!exists){if(data.settings.debug){console.log("addSelected",selected)}data.selected.push(selected);if(data.settings.debug){console.log("newSelected",data.selected)}}}$table.data("bsTable",data);build.hiddenSelectedInputs($table)}function removeSelected($tableElement,row){const $table=$($tableElement);const data=$table.data("bsTable");const checkItem=data.settings.checkItemsConfig;if(data){if(data.settings.debug){console.log("removeSelected",row)}data.selected=data.selected.filter(item=>item[checkItem.field]!==row[checkItem.field]);if(data.settings.debug){console.log("newSelected",data.selected)}}$table.data("bsTable",data);build.hiddenSelectedInputs($table)}function removeAllSelected($tableElement){const $table=$($tableElement);const data=$table.data("bsTable");if(data){if(data.settings.debug){console.log("removeAllSelected")}data.selected=[];if(data.settings.debug){console.log("newSelected",data.selected)}}$table.data("bsTable",data);build.hiddenSelectedInputs($table)}function setSelected($tableElement,rows){const $table=$($tableElement);const data=$table.data("bsTable");if(data){data.selected=rows||[]}$table.data("bsTable",data);build.hiddenSelectedInputs($table)}function setResponse($tableElement,response){const $table=$($tableElement);const data=$table.data("bsTable");if(data){data.response=response||{rows:[],total:0}}$table.data("bsTable",data)}function getToggleView($table){return $($table).data("bsTable").toggleView}function getToggleCustomView($table){return $($table).data("bsTable").toggleCustomView}function setToggleCustomView($table,toggle){const data=$table.data("bsTable");if(data){data.toggleCustomView=toggle}$table.data("bsTable",data)}function setToggleView($tableElement,toggleView){const $table=$($tableElement);const data=$table.data("bsTable");if(data){data.toggleView=toggleView}$table.data("bsTable",data)}function getWrapper($table){return $($table).closest(`.${bsTableClasses.wrapper}`)}function getResponsiveWrapper($table){return $($table).closest(`.${bsTableClasses.wrapperResponsive}`)}function getClosestWrapper($element){return $($element).parent().closest(`.${bsTableClasses.wrapper}`)}function getTableBottomContainer($table){const $wrapper=$(getWrapper($table));return $wrapper.children(`.${bsTableClasses.bottomContainer}`).first()}function getTableTopContainer($table){const $wrapper=$(getWrapper($table));return $wrapper.children(`.${bsTableClasses.topContainer}`).first()}function getPaginationContainer($table,top){if(top){return $(getTableTopContainer($table)).find("."+bsTableClasses.pagination)}else{return $(getTableBottomContainer($table)).find("."+bsTableClasses.pagination)}}function getSearchInput($table){const $wrapper=$(getWrapper($table));const $searchInput=$wrapper.find("."+bsTableClasses.searchInput).filter(function(){return getClosestWrapper($(this))[0]===$wrapper[0]}).first();return $searchInput.length>0?$searchInput:$()}function getOverlay($table){const $wrapper=$(getWrapper($table));const $overlay=$wrapper.find("."+bsTableClasses.overlay).filter(function(){return getClosestWrapper($(this))[0]===$wrapper[0]}).first();return $overlay.length>0?$overlay:$()}function handleSortOnTheadTh($thElement){const $th=$($thElement);const wrapper=$(getClosestWrapper($th));const $table=$(getTableByWrapperId(wrapper.attr("id")));const settings=getSettings($table);const allSortableHeaders=$table.find('thead:first th[data-sortable="true"]');const filteredHeaders=allSortableHeaders.not($th);filteredHeaders.each(function(i,el){const $otherTh=$(el);$otherTh.attr("data-order","");const $icon=$otherTh.find("i.bs-table-icon");$icon.removeClass(settings.icons.sortNone);$icon.removeClass(settings.icons.sortAsc);$icon.removeClass(settings.icons.sortDesc);$icon.addClass(settings.icons.sortNone)});if($th.length>0){let order=$th.attr("data-order");if(order==="asc"){order="desc"}else if(order==="desc"){order=""}else{order="asc"}const $iconCurrent=$th.find("i.bs-table-icon");const field=$th.attr("data-field");$iconCurrent.removeClass(settings.icons.sortNone);$iconCurrent.removeClass(settings.icons.sortAsc);$iconCurrent.removeClass(settings.icons.sortDesc);$th.attr("data-order",order);settings.sortOrder=order===""?null:order;settings.sortName=field;settings.pageNumber=1;switch(order){case"asc":{$iconCurrent.addClass(settings.icons.sortAsc)}break;case"desc":{$iconCurrent.addClass(settings.icons.sortDesc)}break;default:{$iconCurrent.addClass(settings.icons.sortNone)}}}else{settings.sortOrder=null;settings.sortName=null}triggerEvent($table,"sort",settings.sortName,settings.sortOrder);setSettings($table,settings);refresh($table)}function onClickCellAndRow($tdElement){const $td=$($tdElement);if($td.attr("data-check-item")||$td.attr("data-detail-item")){return}const $wrapper=$(getClosestWrapper($td));const $table=$(getTableByWrapperId($wrapper.attr("id")));const settings=getSettings($table);const column=$td.data("column");const $tr=$td.closest("tr");const row=$tr.data("row");const value=row[column.field]??null;triggerEvent($table,"click-row",row,$tr,column.field);triggerEvent($table,"click-cell",column.field,value,row,$td);if(settings.showCheckItems===true&&settings.checkItemsConfig.clickRowToSelect===true){const $checkTd=$tr.find("td[data-check-item]:first");handleCheckItemClicked($checkTd)}if(settings.detailView!==false&&settings.detailView.clickRowToToggle===true){const $checkTd=$tr.find("td[data-detail-item]:first");toggleExpandOrCollapse($checkTd,true)}}function triggerEvent($tableElement,eventName,...args){const $table=$($tableElement);const targetTable=$table[0];const settings=getSettings($table);const isSubTable=$table.closest(`.${bsTableClasses.wrapper}[data-child="true"]`).length>0;const hasSubTables=$(getClosestWrapper($table)).find(`.${bsTableClasses.wrapper}[data-child="true"]`).length>0;const bsTableDatas={table:targetTable,settings:settings,isChildTable:isSubTable,hasChildTables:hasSubTables};const event=$.Event(eventName+namespace,{target:targetTable,bsTable:bsTableDatas});$table.trigger(event,args);event.stopPropagation();if(eventName!=="all"){const allEvent=$.Event(`all${namespace}`,{target:targetTable});$table.trigger(allEvent,[eventName+namespace,...args]);$.bsTable.utils.executeFunction(settings.onAll,eventName+namespace,...args);allEvent.stopPropagation();const eventFunctionName=`on${eventName.split("-").map(word=>word.charAt(0).toUpperCase()+word.slice(1)).join("")}`;$.bsTable.utils.executeFunction(settings[eventFunctionName],...args)}}function getTableByWrapperId(wrapperId){return $(`table[data-wrapper="${wrapperId}"`)}function handleClickOnPaginationSize($table,$aTag){const $a=$($aTag);const settings=getSettings($table);const response=getResponse($table);settings.pageSize=parseInt($a.data("page"));const totalRows=response.total;const maxPageNumber=Math.ceil(totalRows/settings.pageSize);if(settings.pageNumber>maxPageNumber){console.warn(`Page ${settings.pageNumber} is invalid. Falling back to last page (${maxPageNumber}).`);settings.pageNumber=maxPageNumber}setSettings($table,settings);refresh($table)}function handleCheckItemClicked($tdElement){const $td=$($tdElement);const $wrapper=$(getClosestWrapper($td));const $table=$(getTableByWrapperId($wrapper.attr("id")));const settings=getSettings($table);if(settings.showCheckItems!==true){return}let checked=false;const checkItemConfig=settings.checkItemsConfig;const $tr=$td.closest("tr");const row=$tr.data("row");if(checkItemConfig.type==="radio"){removeAllSelected($table);addSelected($table,row);checked=true}else{const selectedRows=getSelected($table);const isSelected=selectedRows.some(selected=>selected[checkItemConfig.field]===row[checkItemConfig.field]);if(isSelected){removeSelected($table,row)}else{checked=true;addSelected($table,row)}}if(checked){triggerEvent($table,"check",row,$td)}else{triggerEvent($table,"uncheck",row,$td)}}function toggleExpandOrCollapse($tdElement,trigger=true){const $td=$($tdElement);const $wrapper=$(getClosestWrapper($td));const $table=$(getTableByWrapperId($wrapper.attr("id")));const settings=getSettings($table);if(settings.detailView===false){return}const $icon=$td.find(`.${bsTableClasses.checkIcon}`).removeClass(settings.icons.expand).removeClass(settings.icons.collapse);let expanded=$td.attr("data-detail-item")==="true";const checkItemConfig=settings.detailView;const $tr=$td.closest("tr");const row=$tr.data("row");if(expanded){$icon.addClass(settings.icons.expand);$td.attr("data-detail-item","false");const $oldTd=$($tr.next().children("td"));if(trigger){triggerEvent($table,"collapse-row",row,$td)}$tr.next().remove();removeExpanded($table,row)}else{$icon.addClass(settings.icons.collapse);addExpanded($table,row);$td.attr("data-detail-item","true");const newTr=$("<tr>").insertAfter($tr);const $newTd=$("<td>",{colspan:getCountColumns($table)}).appendTo(newTr);checkItemConfig.formatter($tr.attr("data-index"),row,$newTd);if(trigger){triggerEvent($table,"expand-row",row,$td)}}}function performSearch($wrapper){const table=getTableByWrapperId($($wrapper).attr("id"));const settings=getSettings(table);settings.pageNumber=1;setSettings(table,settings);refresh(table)}function handleCheckItemAllClicked($thElement){const $th=$($thElement);const checkAll=$th.attr("data-check-item-all")==="false";const $wrapper=$(getClosestWrapper($th));const $table=$(getTableByWrapperId($wrapper.attr("id")));const settings=getSettings($table);if(settings.showCheckItems!==true){return}const checkItemConfig=settings.checkItemsConfig;if(checkItemConfig.type==="radio"&&checkAll){return}const rows=getResponse($table).rows;rows.forEach(row=>{if(checkAll){addSelected($table,row)}else{removeSelected($table,row)}})}function registerGlobalTableEvents(){let searchTimeout;const preventDefault=e=>{e.preventDefault();e.stopPropagation();e.stopImmediatePropagation()};$(document).on(["click"+namespace,"change"+namespace,"input"+namespace,"touchstart"+namespace,"mouseenter"+namespace].join(" "),"."+bsTableClasses.wrapper,function(e){const $target=$(e.currentTarget);if($target.parents("."+bsTableClasses.wrapper).length>0){return}}).on(["click"+namespace,"change"+namespace,"touchstart"+namespace,"mouseenter"+namespace].join(" "),`.${bsTableClasses.wrapper} [data-child="true"]`,function(e){preventDefault(e)}).on("click"+namespace,`.${bsTableClasses.wrapper} tbody > tr[data-index] > td:not([data-check-item],[data-detail-item])`,function(e){if(e.target.tagName==="A"||$(e.target).closest("a").length>0||e.target.tagName==="BUTTON"||$(e.target).closest("button").length>0||e.target.tagName==="INPUT"||$(e.target).closest("input").length>0||e.target.tagName==="TEXTAREA"||$(e.target).closest("textarea").length>0||e.target.tagName==="SELECT"||$(e.target).closest("select").length>0){return}const selection=window.getSelection().toString();if(selection){return}if(e.detail&&e.detail>1){return}preventDefault(e);onClickCellAndRow($(e.currentTarget))}).on("click"+namespace,`.${bsTableClasses.wrapper} tbody td[data-check-item]`,function(e){preventDefault(e);handleCheckItemClicked($(e.currentTarget))}).on("click"+namespace,`.${bsTableClasses.wrapper} tbody td[data-detail-item]`,function(e){preventDefault(e);toggleExpandOrCollapse($(e.currentTarget))}).on("click"+namespace,[`.${bsTableClasses.wrapper} thead th[data-check-item-all]`,`.${bsTableClasses.wrapper} tfoot th[data-check-item-all]`].join(", "),function(e){preventDefault(e);handleCheckItemAllClicked($(e.currentTarget))}).on("click"+namespace,`.${bsTableClasses.wrapper} thead th[data-sortable="true"]`,function(e){preventDefault(e);handleSortOnTheadTh($(e.currentTarget))}).on("click"+namespace,`.${bsTableClasses.wrapper} [data-role="tablePaginationPageSize"] .dropdown-item`,function(e){preventDefault(e);const $a=$(e.currentTarget);if(!$a.length){return}const wrapper=$(getClosestWrapper($a));const table=$(getTableByWrapperId(wrapper.attr("id")));handleClickOnPaginationSize(table,$a)}).on("click"+namespace,`.${bsTableClasses.wrapper} .${bsTableClasses.btnRefresh}`,function(e){preventDefault(e);const $btn=$(e.currentTarget);if(!$btn.length){return}const $wrapper=$(getClosestWrapper($btn));const table=$(getTableByWrapperId($wrapper.attr("id")));refresh(table,null,true)}).on("click"+namespace,`.${bsTableClasses.wrapper} .${bsTableClasses.btnToggle}`,function(e){preventDefault(e);const $btn=$(e.currentTarget);if(!$btn.length){return}const $wrapper=$(getClosestWrapper($btn));const table=$(getTableByWrapperId($wrapper.attr("id")));toggleView(table)}).on("click"+namespace,`.${bsTableClasses.wrapper} .${bsTableClasses.btnCustomView}`,function(e){preventDefault(e);const $btn=$(e.currentTarget);if(!$btn.length){return}const $wrapper=$(getClosestWrapper($btn));const table=$(getTableByWrapperId($wrapper.attr("id")));toggleCustomView(table)}).on("input"+namespace,`.${bsTableClasses.wrapper} .${bsTableClasses.searchInput}`,function(e){preventDefault(e);const $searchField=$(e.currentTarget);if(!$searchField.length){return}const wrapper=getClosestWrapper($searchField);clearTimeout(searchTimeout);searchTimeout=setTimeout(()=>{performSearch(wrapper)},600);if(e.key==="Enter"){e.preventDefault();clearTimeout(searchTimeout);performSearch(wrapper)}}).on("click"+namespace,`.${bsTableClasses.wrapper} .${bsTableClasses.pagination} .page-link`,function(e){preventDefault(e);const $pageLink=$(e.currentTarget);if(!$pageLink.length){return}const wrapper=$(getClosestWrapper($pageLink));const table=$(getTableByWrapperId(wrapper.attr("id")));const settings=getSettings(table);const response=getResponse(table);const totalPages=Math.ceil(response.total/settings.pageSize);if($pageLink.parent().hasClass("disabled")||$pageLink.parent().hasClass("active")){return}const action=$pageLink.attr("data-role")||$pageLink.html().toLowerCase().trim();if(action.includes("previous")||action.includes("left")){settings.pageNumber=Math.max(1,settings.pageNumber-1)}else if(action.includes("next")||action.includes("right")){settings.pageNumber=Math.min(totalPages,settings.pageNumber+1)}else{const pageNum=parseInt($pageLink.text().trim(),10);if(!isNaN(pageNum)){settings.pageNumber=pageNum}}setSettings(table,settings);refresh(table)});$.bsTable.globalEventsBound=true}})(jQuery);