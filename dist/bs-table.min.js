(function($){"use strict";$.bsTable={defaults:{classes:"table",toolbar:null,pagination:true,sidePagination:"server",paginationVAlign:"bottom",pageNumber:1,pageSize:10,showHeader:true,showFooter:true,url:null,data:null,columns:[],rowStyle:function(row,index,$tr){},queryParams:function(params){return params},responseHandler:function(res){return res},onLoadSuccess:function(){},onLoadError:function(){},onPageChange:function(){},onPostBody:function(){}}};const wrapperClass="bs-table-wrapper";const wrapperTableClass="bs-table-inner-wrapper";const wrapperOverlayClass="bs-table-wrapper-overlay";const namespace=".bs.table";$.fn.bsTable=function(optionsOrMethod,...args){if($(this).length===0){return}if($(this).length>1){return $(this).each(function(){return $(this).bsTable(optionsOrMethod,...args)})}const $table=$(this);if(!$table.data("bsTable")){const options=typeof optionsOrMethod==="object"?optionsOrMethod:{};const bsTable={settings:$.extend(true,{},$.bsTable.defaults,$table.data()||{},options)};$table.data("bsTable",bsTable);buildTable($table);events($table)}return $table};function fetchDataWithPromise($table){return new Promise((resolve,reject)=>{const settings=getSettings($table);if(!settings.url){reject(new Error("Es wurde keine URL konfiguriert."));return}let params={};if(settings.pagination){params.limit=settings.pageSize;params.offset=(settings.pageNumber-1)*settings.pageSize}if(typeof settings.queryParams==="function"){params=settings.queryParams(params)}$.ajax({url:settings.url,method:"GET",data:params,dataType:"json"}).done(response=>{if(typeof settings.responseHandler==="function"){response=settings.responseHandler(response)}if(typeof settings.onLoadSuccess==="function"){settings.onLoadSuccess(response)}resolve(response)}).fail((xhr,textStatus,errorThrown)=>{console.error("Fehler beim Abrufen der Daten:",textStatus,errorThrown);if(typeof settings.onLoadError==="function"){settings.onLoadError(xhr,textStatus,errorThrown)}reject(new Error(`Fehler: ${textStatus}, ${errorThrown}`))})})}function buildTable($table){$table.empty();const settings=getSettings($table);const $wrapper=$('<div class="'+wrapperClass+' position-relative"></div>').insertAfter($table);let tableClasses="";if(typeof settings.classes==="string"){tableClasses=settings.classes}else if(typeof settings.classes==="object"){tableClasses=settings.classes.table}const $tableResponsiveWrapper=$('<div class="position-relative"></div>').appendTo($wrapper);$table.appendTo($tableResponsiveWrapper);const $paginationContainerTop=$('<div class="bs-table-pagination-container top"></div>').appendTo($wrapper);const $paginationContainerBottom=$('<div class="bs-table-pagination-container bottom"></div>').appendTo($wrapper);$table.addClass(tableClasses);$("<thead></thead>").appendTo($table);$("<tbody></tbody>").appendTo($table);$("<tfoot></tfoot>").appendTo($table);if(settings.toolbar&&$(settings.toolbar).length>0){$(settings.toolbar).prependTo($wrapper)}buildTableHeader($table,settings.columns);showLoading($table);if(settings.sidePagination==="server"){if(!settings.url){console.error("Keine URL definiert fÃ¼r den serverseitigen Modus!");return}fetchDataWithPromise($table).then(response=>{renderTableWithPagination($table,settings,response,$paginationContainerTop,$paginationContainerBottom)}).catch(error=>{console.error("Fehler beim Abrufen der Server-Daten:",error.message)}).finally(()=>{hideLoading($table)})}else if(settings.sidePagination==="client"){if(settings.data&&Array.isArray(settings.data)&&settings.data.length>0){const clientResponse={rows:settings.data,total:settings.data.length};renderTableWithPagination($table,settings,clientResponse,$paginationContainerTop,$paginationContainerBottom)}else if(settings.url){fetchDataWithPromise($table).then(response=>{settings.data=response.rows||response;renderTableWithPagination($table,settings,{rows:settings.data,total:settings.data.length},$paginationContainerTop,$paginationContainerBottom)}).catch(error=>{console.error("Fehler beim Abrufen der Daten:",error.message)}).finally(()=>{hideLoading($table)})}else{hideLoading($table);console.error("Keine Datenquelle definiert!")}}}function hideLoading($table){const $overlay=$table.closest("."+wrapperClass).find("."+wrapperOverlayClass);$overlay.remove()}function showLoading($table){const settings=getSettings($table);const wrapper=$table.closest("."+wrapperClass);hideLoading($table);const columnCount=settings.columns.length;const rowCount=settings.pageSize;const $overlay=$("<div>",{class:wrapperOverlayClass+" position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center opacity-75 bg-body",css:{zIndex:4}}).appendTo(wrapper);const $content=$(`
<div class="spinner-border"  style="width: 3rem; height: 3rem;"   role="status">
  <span class="visually-hidden">Loading...</span>
</div>`).appendTo($overlay)}function renderTableWithPagination($table,settings,response){console.log("RenderTable Input Data:",response);const totalRows=response.total||(response.rows?response.rows.length:0);const pageSize=settings.pageSize;const pageNumber=settings.pageNumber;let currentPageData=response.rows;if(settings.sidePagination==="client"){const start=(pageNumber-1)*pageSize;const end=start+pageSize;currentPageData=response.rows.slice(start,end)}console.log("Current Page Data:",currentPageData);console.log("Columns:",settings.columns);if(settings.columns&&settings.columns.length){buildTableHeader($table,settings.columns);buildTableBody($table,currentPageData);buildTableFooter($table,settings.columns,response.rows)}else{console.log("no columns in settings!")}if(settings.pagination){const $wrapper=$table.closest(`.${wrapperClass}`);$wrapper.find(".bs-table-pagination-container").remove();const $paginationHtml=createPagination($table,totalRows);if(settings.paginationVAlign==="top"||settings.paginationVAlign==="both"){const $topPaginationContainer=$('<div class="bs-table-pagination-container top"></div>');$topPaginationContainer.append($paginationHtml.clone());$wrapper.prepend($topPaginationContainer)}if(settings.paginationVAlign==="bottom"||settings.paginationVAlign==="both"){const $bottomPaginationContainer=$('<div class="bs-table-pagination-container bottom"></div>');$bottomPaginationContainer.append($paginationHtml.clone());$wrapper.append($bottomPaginationContainer)}}}function createPagination($table,totalRows){const settings=getSettings($table);const totalPages=Math.ceil(totalRows/settings.pageSize);const currentPage=settings.pageNumber||1;const $paginationWrapper=$("<nav></nav>",{"aria-label":"Table pagination"});const $paginationList=$("<ul></ul>",{class:"pagination justify-content-center"}).appendTo($paginationWrapper);const $firstItem=$("<li></li>",{class:`page-item ${currentPage===1?"disabled":""}`}).appendTo($paginationList);$("<a></a>",{"aria-label":"first",class:"page-link",href:"#",tabindex:currentPage===1?"-1":"","aria-disabled":currentPage===1?"true":"false",html:'<i class="bi bi-chevron-double-left"></i>'}).appendTo($firstItem).on("click",function(e){e.preventDefault();if(currentPage>1){settings.pageNumber=1;setSettings($table,settings);handlePaginationChange($table)}});const $prevItem=$("<li></li>",{"aria-label":"previous",class:`page-item ${currentPage===1?"disabled":""}`}).appendTo($paginationList);$("<a></a>",{class:"page-link",href:"#",tabindex:currentPage===1?"-1":"","aria-disabled":currentPage===1?"true":"false",html:'<i class="bi bi-chevron-left"></i>'}).appendTo($prevItem).on("click",function(e){e.preventDefault();if(currentPage>1){settings.pageNumber=currentPage-1;setSettings($table,settings);handlePaginationChange($table)}});const visiblePages=calculateVisiblePages(totalPages,currentPage);visiblePages.forEach(page=>{if(page==="..."){$("<li></li>",{class:"page-item disabled"}).append($("<a></a>",{class:"page-link",text:"..."})).appendTo($paginationList)}else{const $pageItem=$("<li></li>",{class:`page-item ${page===currentPage?"active":""}`}).appendTo($paginationList);$("<a></a>",{class:"page-link",href:"#",text:page}).appendTo($pageItem).on("click",function(e){e.preventDefault();if(page!==currentPage){settings.pageNumber=page;setSettings($table,settings);handlePaginationChange($table)}})}});const $nextItem=$("<li></li>",{class:`page-item ${currentPage===totalPages?"disabled":""}`}).appendTo($paginationList);$("<a></a>",{"aria-label":"next",class:"page-link",href:"#",tabindex:currentPage===totalPages?"-1":"","aria-disabled":currentPage===totalPages?"true":"false",html:'<i class="bi bi-chevron-right"></i>'}).appendTo($nextItem).on("click",function(e){e.preventDefault();if(currentPage<totalPages){settings.pageNumber=currentPage+1;setSettings($table,settings);handlePaginationChange($table)}});const $lastItem=$("<li></li>",{class:`page-item ${currentPage===totalPages?"disabled":""}`}).appendTo($paginationList);$("<a></a>",{"aria-label":"last",class:"page-link",href:"#",tabindex:currentPage===totalPages?"-1":"","aria-disabled":currentPage===totalPages?"true":"false",html:'<i class="bi bi-chevron-double-right"></i>'}).appendTo($lastItem).on("click",function(e){e.preventDefault();if(currentPage<totalPages){settings.pageNumber=totalPages;setSettings($table,settings);handlePaginationChange($table)}});return $paginationWrapper}function handlePaginationChange($table){const settings=getSettings($table);if(settings.sidePagination==="server"){fetchDataWithPromise($table).then(response=>{const $paginationContainer=$table.closest(`.${wrapperClass}`).find(".bs-table-pagination");renderTableWithPagination($table,settings,response,$paginationContainer)}).catch(error=>{console.error("Fehler beim Abruf der Server-Daten:",error.message)})}else if(settings.sidePagination==="client"){const totalRows=settings.data.length;const $paginationContainer=$table.closest(`.${wrapperClass}`).find(".bs-table-pagination");renderTableWithPagination($table,settings,{rows:settings.data,total:totalRows},$paginationContainer)}}function calculateVisiblePages(totalPages,currentPage){const visiblePages=[];const maxVisible=8;const half=Math.floor(maxVisible/2);let startPage=Math.max(1,currentPage-half);const endPage=Math.min(totalPages,currentPage+half);for(let i=startPage;i<=endPage;i++){visiblePages.push(i)}if(startPage>1){visiblePages.unshift("...")}if(endPage<totalPages){visiblePages.push("...")}return visiblePages}function calculateVisiblePages(totalPages,currentPage){const visiblePages=[];if(totalPages<=8){for(let i=1;i<=totalPages;i++){visiblePages.push(i)}}else{visiblePages.push(1);if(currentPage>4){visiblePages.push("...")}const start=Math.max(2,currentPage-2);const end=Math.min(totalPages-1,currentPage+2);for(let i=start;i<=end;i++){visiblePages.push(i)}if(currentPage<totalPages-3){visiblePages.push("...")}visiblePages.push(totalPages)}return visiblePages}function buildTableHeader($table,columns){const settings=getSettings($table);if(settings.showHeader===false){return}let tableClasses="";if(typeof settings.classes==="object"){tableClasses=settings.classes.thead}if(columns&&columns.length){const $thead=$table.find("thead").empty().addClass(tableClasses);const $tr=$("<tr></tr>").appendTo($thead);columns.forEach(column=>{const $th=$("<th>",{html:column.title??""}).appendTo($tr)})}}function buildTableFooter($table,columns,data){const settings=getSettings($table);if(settings.showFooter===false){return}let tableClasses="";if(typeof settings.classes==="object"){tableClasses=settings.classes.tfoot}if(columns&&columns.length){const $tfoot=$table.find("tfoot").empty().addClass(tableClasses);const $tr=$("<tr></tr>").appendTo($tfoot);columns.forEach(column=>{let value="";if(typeof column.footerFormatter==="function"){value=column.footerFormatter(data)}const $td=$("<td>",{html:value}).appendTo($tr)})}}function buildTableBody($table,rows){const settings=getSettings($table);if(rows&&rows.length){let tableClasses="";if(typeof settings.classes==="object"){tableClasses=settings.classes.tbody}const $tbody=$table.find("tbody").empty().addClass(tableClasses);let trIndex=0;rows.forEach(row=>{const $tr=$("<tr>",{"data-index":trIndex}).appendTo($tbody);if(typeof settings.rowStyle==="function"){settings.rowStyle(row,trIndex,$tr)}if(settings.columns&&settings.columns.length){settings.columns.forEach(column=>{buildTableBodyTd(column,row,$tr)})}trIndex++})}}function buildTableBodyTd(column,row,$tr){if(column.field){let classList=[];if(column.class){column.class.split(" ").forEach(className=>{classList.push(className)})}if(column.align){classList.push("text-"+column.align)}if(column.valign){classList.push("align-"+column.valign)}const $td=$("<td>",{class:classList.join(" ")}).appendTo($tr);let value=row[column.field]??" - ";if(column.formatter&&typeof column.formatter==="function"){const customValue=column.formatter(value,row,$tr.data("index"),$td);if(typeof customValue==="string"&&customValue.trim()!==""){value=customValue}}$td.html(value);if(column.events){for(const[eventSelector,eventHandler]of Object.entries(column.events)){const splitEvent=eventSelector.split(" ");const selector=splitEvent.pop();const eventTypes=splitEvent.join(" ");if(selector){$td.on(eventTypes,selector,function(e){const index=$tr.data("index");eventHandler(e,row[column.field]??null,row,index)})}else{$td.on(eventTypes,function(e){const index=$tr.data("index");eventHandler(e,row[column.field]??null,row,index)})}}}}}function getSettings($table){return $table.data("bsTable").settings}function setSettings($table,settings){const data=$table.data("bsTable");if(data){data.settings=settings}$table.data("bsTable",data)}function events($table){const wrapper=$table.closest(`.${wrapperClass}`);wrapper.on("click",".bs-table-pagination-container .page-link",function(e){e.preventDefault();const settings=getSettings($table);const $this=$(this);if($this.parent().hasClass("disabled")||$this.parent().hasClass("active")){return}const action=$this.attr("aria-label")||$this.html().toLowerCase().trim();const totalPages=Math.ceil(settings.data.length/settings.pageSize);console.log("Action:",action);if(action.includes("first")){settings.pageNumber=1}else if(action.includes("last")){settings.pageNumber=totalPages}else if(action.includes("previous")||action.includes("left")){settings.pageNumber=Math.max(1,settings.pageNumber-1)}else if(action.includes("next")||action.includes("right")){settings.pageNumber=Math.min(totalPages,settings.pageNumber+1)}else{const pageNum=parseInt($this.text().trim(),10);if(!isNaN(pageNum)){settings.pageNumber=pageNum}}setSettings($table,settings);handlePaginationChange($table)})}})(jQuery);