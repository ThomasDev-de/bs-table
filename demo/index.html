<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>$.fn.bsTable</title>
    <link href="../vendor/twbs/bootstrap-icons/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="../vendor/twbs/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
    <style>
        .converted-from-markdown {
            ul {
                margin: 0; /* Entfernt den oberen und unteren Abstand der ul-Liste */
                padding-left: .5rem; /* Optional: Kontrolliere den linken Abstand der Punkte */
                list-style-position: inside; /* Punkte in den Rahmen der Liste setzen */
            }

            ul li {
                margin-bottom: 0.25rem; /* Verkleinert den Abstand zwischen den einzelnen <li>-Elementen */
                padding: 0; /* Entfernt zusätzliches Padding */
            }
        }

    </style>
</head>
<body>


<nav class="navbar navbar-expand-lg bg-body-tertiary sticky-top">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">$.fn.bsTable</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="#toolbar_table">Table Options</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#table_events_toolbar">Table Events</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#table_column_options">Column Options</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container py-5">
<pre class="m-0">
    <code class="hl-me language-javascript">$.bsTable.setDefaults({
    classes: {
        table: 'table align-top table-sm table-bordered table-dark mb-0',
        thead: 'h4 table-primary',
        tbody: 'table-group-divider',
        caption: 'text-center text-bg-primary bg-gradient',
    },
    showColumns: true,
    pagination: false,
    onPostBody: function (rows, $table) {
        const elements = $table.find('code');
        elements.each(function (index, element) {
            hljs.highlightElement(element);
        });
    }
});</code></pre>


    <div class="" id="toolbar_table"><h3 class="mb-0">Table Options</h3></div>
    <div id="table_events_toolbar">
        <h3>Table Events</h3>
        <p>
        This table includes the mapping between the `onX` callback functions and their corresponding global events in the
            `bsTable` lifecycle:</p>
    </div>
    <table id="table_table_options"></table>
    <table id="table_column_options"></table>
    <table id="table_table_events" data-toolbar="#table_events_toolbar"></table>
</div>
<script src="../vendor/components/jquery/jquery.min.js"></script>
<script src="../vendor/twbs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="../dist/bs-table.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>


<script>
    $(document).ready(function () {

        async function getDatas() {
            return new Promise((resolve, reject) => {
                $.getJSON('data.json', function (data) {
                    resolve(data)
                });
            })
        }

        async function getOptions() {
            return new Promise((resolve) => {
                $.getJSON('options.json', function (data) {
                    resolve(data)
                });
            })
        }

        async function getEvents() {
            return new Promise((resolve) => {
                $.getJSON('events.json', function (data) {
                    resolve(data)
                });
            })
        }
        async function getColumn() {
            return new Promise((resolve) => {
                $.getJSON('column.json', function (data) {
                    resolve(data)
                });
            })
        }

        $.bsTable.setDefaults({
            classes: {
                table: 'table align-top table-sm table-bordered table-dark mb-0',
                thead: 'h5 table-primary bg-gradient',
                tbody: 'table-group-divider',
                caption: 'text-center text-bg-primary bg-gradient fw-bold',
            },
            showColumns: true,
            pagination: false,
            onPostBody: function (rows, $table) {
                const elements = $table.find('code');
                elements.each(function (index, element) {
                    hljs.highlightElement(element);
                });
            },
        });

        getColumn().then(data => {
            const tableTableOptions = $('#table_column_options');
            tableTableOptions.bsTable({
                toolbar: '#toolbar_table',
                sortName: 'option',
                data: data,
                caption: {
                    text: "Column options",
                    onTop: true,
                },
                columns: [
                    {
                        width: 100,
                        class: 'text-nowrap pe-3',
                        field: 'option',
                        title: 'Option',
                        visible: true,
                        sortable: true,
                        align: 'end',
                        valign: 'middle',
                        formatter(value, row, index, $td) {
                            $td.addClass('table-active');
                            const text = '##### ' + value;
                            return formatMarkdownToHtml(text);
                        },

                    },
                    {
                        width: 100,
                        valign: 'middle',
                        class: 'text-nowrap',
                        title: 'Type',
                        field: 'type',
                        formatter(value) {
                            const text = '`' + value + '`';
                            return formatMarkdownToHtml(text);
                        }
                    },
                    {
                        width: 100,
                        valign: 'middle',
                        // class: 'text-nowrap',
                        title: 'Default',
                        field: 'default',
                        formatter(value) {
                            let formattedValue;

                            if (value === null || value === 'nul') {
                                // Null-Werte
                                formattedValue = 'null';
                            } else if (typeof value === 'boolean') {
                                // Boolean-Werte
                                formattedValue = value.toString();
                            } else if (!isNaN(value)) {
                                // Zahlen parsen (wenn der Wert keine leere Zeichenkette ist)
                                formattedValue = Number(value);
                            } else {
                                // Alle anderen Werte (sind Strings)
                                formattedValue = `"${value}"`;
                            }

                            const text = '`' + formattedValue + '`';

                            // Markdown formatieren (für Konsistenz mit anderer Logik)
                            return formatMarkdownToHtml(text);
                        }
                    },
                    {
                        title: 'Description',
                        width: '20%',
                        field: 'description',
                        formatter: formatMarkdownToHtml
                    },
                    {
                        width: 400,
                        title: 'Examples',
                        field: 'examples',
                        formatter(examples, row, index, $td) {
                            const html = renderCodeTabs(examples, index);
                            $td.html(html);

                        }
                    },
                ]
            });
        });

        getEvents().then(data => {
            const tableTableEvents = $('#table_table_events');
            tableTableEvents.bsTable({
                sortName: 'functionName',
                data: data,
                caption: {
                    text: "Table Events",
                    onTop: true,
                },
                responseHandler(res) {
                    res.rows.forEach(row => {
                        const paramsPart = row.params ? `${row.params}` : ''; // Parameter nur setzen, wenn sie existieren
                        const consoleLog = row.params ? `console.log(${row.params})` : '// ';
                        // Initialisiere die examples mit nur einem Beispiel
                        row.examples = [
                            {
                                language: "javascript",
                                code: `$('#table').bsTable({
    ${row.functionName}(${paramsPart}) {
        ${consoleLog}
    }
});

$('#table').on(${row.global || '`event-name`'}, function(e${row.params ? `, ${row.params}` : ''}) {
     ${consoleLog}
});`
                            }
                        ];
                    });
                    return res;
                },
                columns: [
                    {
                        field: 'functionName',
                        formatter(value) {
                            const text = '`' + value + '`';
                            return formatMarkdownToHtml(text);
                        }
                    },
                    {
                        field: 'global',
                        formatter(value) {
                            const text = '`' + value + '`';
                            return formatMarkdownToHtml(text);
                        }
                    },
                    {
                        width:300,
                        title: 'Description',
                        field: 'description',
                        formatter: formatMarkdownToHtml
                    },
                    {
                        title: 'Examples',
                        field: 'examples',
                        formatter(examples, row, index, $td) {
                            const html = renderCodeTabs(examples, index);
                            $td.html(html);

                        }
                    },
                ]
            });
        })

        getOptions().then(data => {
            const tableTableOptions = $('#table_table_options');

            tableTableOptions.bsTable({
                toolbar: '#toolbar_table',
                sortName: 'option',
                data: data,
                caption: {
                    text: "Table Options",
                    onTop: true,
                },
                columns: [
                    {
                        width: 100,
                        class: 'text-nowrap pe-3',
                        field: 'option',
                        title: 'Option',
                        visible: true,
                        sortable: true,
                        align: 'end',
                        valign: 'middle',
                        formatter(value, row, index, $td) {
                            $td.addClass('table-active');
                            const text = '##### ' + value;
                            return formatMarkdownToHtml(text);
                        },

                    },
                    {
                        width: 100,
                        valign: 'middle',
                        class: 'text-nowrap',
                        title: 'Type',
                        field: 'type',
                        formatter(value) {
                            const text = '`' + value + '`';
                            return formatMarkdownToHtml(text);
                        }
                    },
                    {
                        width: 100,
                        valign: 'middle',
                        // class: 'text-nowrap',
                        title: 'Default',
                        field: 'default',
                        formatter(value) {
                            let formattedValue;

                            if (value === null || value === 'nul') {
                                // Null-Werte
                                formattedValue = 'null';
                            } else if (typeof value === 'boolean') {
                                // Boolean-Werte
                                formattedValue = value.toString();
                            } else if (!isNaN(value)) {
                                // Zahlen parsen (wenn der Wert keine leere Zeichenkette ist)
                                formattedValue = Number(value);
                            } else {
                                // Alle anderen Werte (sind Strings)
                                formattedValue = `"${value}"`;
                            }

                            const text = '`' + formattedValue + '`';

                            // Markdown formatieren (für Konsistenz mit anderer Logik)
                            return formatMarkdownToHtml(text);
                        }
                    },
                    {
                        title: 'Description',
                        width: '20%',
                        field: 'description',
                        formatter: formatMarkdownToHtml
                    },
                    {
                        width: 400,
                        title: 'Examples',
                        field: 'examples',
                        formatter(examples, row, index, $td) {
                            const html = renderCodeTabs(examples, index);
                            $td.html(html);

                        }
                    },
                ]
            });


        });


        function formatMarkdownToHtml(value) {
            if (!value) {
                return '<span class="text-muted">Keine Beschreibung verfügbar</span>';
            }

            // Prüfen und Markdown in HTML konvertieren
            const html = typeof marked.parse === 'function' ? marked.parse(value) : marked(value);

            // Ergebnis zurückgeben
            return `<div class="converted-from-markdown">${html}</div>`;
        }


        function renderCodeTabs(examples, mainIndex) {
            if (!examples || examples.length === 0) {
                return '';
            }

            let tabsHtml = '<ul class="nav nav-tabs" role="tablist">';
            let tabContentHtml = '<div class="tab-content border-end border-start border-bottom p-0">';

            examples.forEach((example, index) => {
                const isActive = index === 0 ? 'active' : '';
                let formattedCode = example.code;

                // Falls Sprache "json" ist, konvertiere in einen String
                if (example.language === "json") {
                    formattedCode = JSON.stringify(example.code, null, 2);
                }

                // Falls Sprache "html" ist, escape spezielle Zeichen
                if (example.language === "html") {
                    formattedCode = escapeHtml(formattedCode);
                }

                tabsHtml += `
            <li class="nav-item">
                <button class="nav-link ${isActive}" id="example-tab-${mainIndex}-${index}" data-bs-toggle="tab" data-bs-target="#example-content-${mainIndex}-${index}" type="button" role="tab">
                    ${example.language.toUpperCase()}
                </button>
            </li>`;

                tabContentHtml += `
            <div class="tab-pane fade ${isActive} show" id="example-content-${mainIndex}-${index}" role="tabpanel">
                <pre class="m-0"><code class="language-${example.language}">${formattedCode}</code></pre>
            </div>`;
            });

            tabsHtml += '</ul>';
            tabContentHtml += '</div>';

            return `<div class="example-tabs">${tabsHtml}${tabContentHtml}</div>`;
        }

// Escape-Funktion für HTML
        function escapeHtml(text) {
            return text
                .replace(/&/g, '&amp;')   // Escape "&"
                .replace(/</g, '&lt;')   // Escape "<"
                .replace(/>/g, '&gt;')   // Escape ">"
                .replace(/"/g, '&quot;') // Escape '"'
                .replace(/'/g, '&#039;'); // Escape "'"
        }


        $(document).on('post-body.bs.table', '#table_table_options', function (e, ...args) {

            if (e.target !== e.currentTarget) {
                console.log('[DEBUG] Event ignoriert, da Subtable: ' + $(e.target).attr('id'));
                return;
            }
            console.log(e.bsTable)
            console.log('Tabelle mit id #' + $(e.target).attr('id') + ' hat gefeuert');
            // console.table(args);
        });


        hljs.highlightElement($('.hl-me').get(0));

    })
</script>
</body>
</html>
